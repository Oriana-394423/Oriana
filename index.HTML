import React, { useRef, useEffect, useState } from "react";

export default function OrianaVolleyballProfile() {
  const canvasRef = useRef(null);
  const [scoreA, setScoreA] = useState(0);
  const [scoreB, setScoreB] = useState(0);
  const [msg, setMsg] = useState("Click to hit the ball as Oriana!");

  const left = ["Allison", "Harper", "Lauren", "Charlotte", "Emily"];
  const right = ["Parker", "Jazmine", "Chloe", "Bella", "Oriana"];

  useEffect(() => {
    const c = canvasRef.current, ctx = c.getContext("2d");
    const W = 960, H = 520; c.width = W; c.height = H;
    const net = { x: W / 2 - 3, w: 6 }, g = 0.35;

    const players = [...left.map((n,i)=>({n,x:100+i*80,y:H-100})),
      ...right.map((n,i)=>({n,x:W/2+100+i*80,y:H-100,isUser:n==="Oriana"}))];
    const ori = players.find(p=>p.isUser);

    const ball = {x:W/2,y:120,vx:2,vy:2,r:12};

    let mouseX = ori.x;
    c.onmousemove = e => mouseX = (e.offsetX/W)*W;
    c.onclick = ()=>hit(ori);

    function hit(p){ 
      if(Math.hypot(ball.x-p.x, ball.y-p.y)<60){
        ball.vx = (p.x<W/2?1:-1)*4; ball.vy=-6;
        setMsg(`${p.n} hits!`);
      }
    }

    function loop(){
      ctx.clearRect(0,0,W,H);
      // bg
      let sky = ctx.createLinearGradient(0,0,0,H);
      sky.addColorStop(0,"#fff9f0"); sky.addColorStop(1,"#ffd97a");
      ctx.fillStyle=sky; ctx.fillRect(0,0,W,H);
      ctx.fillStyle="gold"; ctx.beginPath(); ctx.arc(120,80,40,0,7); ctx.fill();
      // net
      ctx.fillStyle="gold"; ctx.fillRect(net.x,H-200,net.w,80);

      // ball physics
      ball.vy+=g; ball.x+=ball.vx; ball.y+=ball.vy;
      if(ball.y+ball.r>H-40){ 
        ball.y=H-40-ball.r; ball.vy*=-0.6;
        if(ball.x<W/2) setScoreB(s=>s+1); else setScoreA(s=>s+1);
      }
      ctx.fillStyle="#f7c948"; ctx.beginPath(); ctx.arc(ball.x,ball.y,ball.r,0,7); ctx.fill();

      // draw players
      players.forEach(p=>{
        if(p.isUser) p.x+=(mouseX-p.x)*0.1;
        ctx.beginPath(); ctx.arc(p.x,p.y,20,0,7);
        ctx.fillStyle=p.isUser?"#fffbea":"#fff"; ctx.fill();
        ctx.fillStyle="#333"; ctx.font="12px sans-serif"; ctx.fillText(p.n,p.x,p.y+34);
      });

      requestAnimationFrame(loop);
    }
    loop();
  }, []);

  return (
    <div className="flex flex-col items-center gap-2">
      <h1 className="text-2xl font-bold text-yellow-700">Oriana Volleyball</h1>
      <canvas ref={canvasRef} className="border rounded shadow" />
      <p>{msg}</p>
      <p className="font-semibold">Left {scoreA} - Right {scoreB}</p>
    </div>
  );
}
